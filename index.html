<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Integrating Statistics with Deep Learning   for Improved Lung Cancer Risk Assessment</title>
    <meta charset="utf-8" />
    <meta name="author" content="Martin Skarzynski" />
    <meta name="date" content="2020-02-11" />
    <script src="libs/header-attrs-2.1/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Integrating Statistics with Deep Learning <br> for Improved Lung Cancer Risk Assessment
### Martin Skarzynski
### 2020-02-11

---


&lt;style type="text/css"&gt;
.remark-slide-content {
    font-size: 35px;
    padding: 1em 4em 1em 4em;
}
.large { font-size: 130% }
.small { font-size: 55% }
.remark-slide-number {
  display: none;
}
figure {
  text-align: center;
  font-size: large;
}

.remark-code, .remark-inline-code { font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
                                    font-size: 64%;
                                  }

&lt;/style&gt;



# Lung cancer screening

Low-dose computed tomography (LDCT)

.center[
  &lt;a href="https://qualityhealthcareplease.files.wordpress.com/2013/09/lung-nodule.png"&gt;
    &lt;img src='https://qualityhealthcareplease.files.wordpress.com/2013/09/lung-nodule.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Lung cancer screening saves lives [(NLST, 2011)](https://doi.org/10.1056/NEJMoa1102873)

.center[
  &lt;a href="https://doi.org/10.1056/NEJMoa1102873"&gt;
    &lt;img src='images/nlst-mortality.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# The Problem

.center[
  &lt;a href="https://twitter.com/chrisalbon/status/1227069427125870592?s=20"&gt;
    &lt;img src="images/error-types.jpeg" height='600'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Lung cancer screening is inefficient &lt;a href="https://doi.org/10.1016/S2213-2600(19)30136-5"&gt;(IARC, 2018)&lt;/a&gt;

Of 1000 individuals scanned 3 times:

.center[
  &lt;a href="https://doi.org/10.1016/S2213-2600(19)30136-5"&gt;
    &lt;img src='images/iarc-infographic-normals.png' height='400'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Lung cancer screening is inefficient &lt;a href="https://doi.org/10.1016/S2213-2600(19)30136-5"&gt;(IARC, 2018)&lt;/a&gt;

Of 1000 individuals scanned 3 times:

.center[
  &lt;a href="https://doi.org/10.1016/S2213-2600(19)30136-5"&gt;
    &lt;img src='images/iarc-infographic-positives.png' height='400'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Lung cancer screening benefits &gt; harms &lt;a href="https://doi.org/10.1016/S2213-2600(19)30136-5"&gt;(IARC, 2018)&lt;/a&gt;

Of 1000 individuals scanned 3 times:

- Major complication from procedure: 1 in 2500 
  &lt;img src='images/two-fifths.gif' height='50'&gt;&lt;/img&gt;
- Death within 60 days of procedure: 1 in 5000 
  &lt;img src='images/one-fifth.gif' height='50'&gt;&lt;/img&gt;

---

# Targeted lung cancer screening [(Kovalchik, 2013)](https://www.nejm.org/doi/10.1056/NEJMoa1301851)

.center[
  &lt;a href="https://www.nejm.org/doi/10.1056/NEJMoa1301851"&gt;
    &lt;img src='images/targeted-lung-cancer-screening.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Our approach

1. Neural network (NN)
- If negative, Emphysematous vs. Non-Emphysematous
- If positive, Benign vs. Malignant
2. Aggregation algorithm
- Combine
    - NN output with
    - Prescreening risk model output

---

# Stacking

.center[
  &lt;a href="https://blogs.sas.com/content/subconsciousmusings/files/2017/05/modelstacking.png"&gt;
    &lt;img src="https://blogs.sas.com/content/subconsciousmusings/files/2017/05/modelstacking.png" height='550'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Statistical Models
1. Bach Model
  - .small[Bach et al., (2003) Variations in lung cancer risk among smokers.JNCI 95: 470-478]
1. Prostate, Lung, Colorectal, and Ovarian Cancer Screening Trial Model 2012 (PLCOM2012)
  - .small[Tammemägi et al., (2013) Selection criteria for lung-cancer screening. NEJM 368:728-736]
1. Lung Cancer Risk Assessment Tool (LCRAT)
  - .small[Katki et al., (2016) Development and validation of risk models to select ever-smokers for CT lung cancer screening. JAMA 315:2300-2311]

---

| Covariate                         | Bach | PLCOm2012 | LCRAT |
|-----------------------------------|------|-----------|-------|
| Age                               | Yes  | Yes       | Yes   |
| Gender                            | Yes  | No        | Yes   |
| Race/ethnicity                    | No   | Yes       | Yes   |
| Education                         | No   | Yes       | Yes   |
| BMI                               | No   | Yes       | Yes   |
| Years/Age quit                    | Yes  | Yes       | Yes   |
| Years smoked                      | Yes  | Yes       | Yes   |
| Cigs per day                      | Yes  | Yes       | Yes   |
| Pack-years                        | No   | No        | Yes   |
| Lung disease                      | No   | Yes       | Yes   |
| Num. FDR w/ LC                    | No   | No        | Yes   |

---


# Cancer risk prediction

- Typically (binary) classification
  - Alive vs. Dead
  - Benign vs. Malignant
  - Cancerous vs. Non-Cancerous
  - Negative vs. Positive

.center[
  &lt;a href="https://media.istockphoto.com/vectors/minus-plus-sign-icons-negative-and-positive-symbols-icon-set-vector-id1014086122?k=6&amp;m=1014086122&amp;s=170667a&amp;w=0&amp;h=MrFi-YgZCa1s5RL9aB0ABF5-UoHqiMiHt-MyVfW3210="&gt;
    &lt;img src="https://media.istockphoto.com/vectors/minus-plus-sign-icons-negative-and-positive-symbols-icon-set-vector-id1014086122?k=6&amp;m=1014086122&amp;s=170667a&amp;w=0&amp;h=MrFi-YgZCa1s5RL9aB0ABF5-UoHqiMiHt-MyVfW3210=" height='250'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Image classification

.center[
  &lt;a href="https://miro.medium.com/max/3840/1*oB3S5yHHhvougJkPXuc8og.gif"&gt;
    &lt;img src="https://miro.medium.com/max/3840/1*oB3S5yHHhvougJkPXuc8og.gif" height='550'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]


---

# Image classification

.center[
  &lt;a href="https://i1.wp.com/sourcedexter.com/wp-content/uploads/2017/05/tensorflow-1.gif?fit=1280%2C720&amp;ssl=1"&gt;
    &lt;img src="https://i1.wp.com/sourcedexter.com/wp-content/uploads/2017/05/tensorflow-1.gif?fit=1280%2C720&amp;ssl=1" height='500'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Emphysema

.center[
  &lt;a href="https://doi.org/10.1093/jnci/djz041"&gt;
    &lt;img src='images/emphysema.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
]

---

# Emphysema is commonly caused by smoking [(ALA)](https://www.lung.org/lung-health-and-diseases/lung-disease-lookup/emphysema/)

.center[
  &lt;a href="https://doi.org/10.1093/jnci/djz041"&gt;
    &lt;img src='images/smoking.jpg' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
]

---

# Likelihood ratio test [(lmtest::lrtest)](https://www.rdocumentation.org/packages/lmtest/versions/0.9-36/topics/lrtest)

```
lmtest::lrtest(neg_t0, neg_emph_t0)
```

```
Model 1: case ~ log1yrisk - 1
Model 2: case ~ log1yrisk + log1yrisk:emphysema - 1

  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   1 -370.74
2   2 -367.43  1 6.6249   0.010056 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
```

---

# Deep learning versus visual scoring [(Humphries, 2018)](https://link.springer.com/chapter/10.1007/978-3-030-00946-5_32)

.center[
  &lt;a href="https://link.springer.com/chapter/10.1007/978-3-030-00946-5_32"&gt;
    &lt;img src='images/deeplearning.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
]


---

# Model design

.center[
  &lt;img src='images/emphnet1.png' height='450'&gt;&lt;/img&gt;
  ]

---

# Input


.center[
  &lt;img src='images/eight.gif' height='450'&gt;&lt;/img&gt;
  ]

---

# Convolution


.center[
  &lt;img src='images/convolution_schematic.gif' height='450'&gt;&lt;/img&gt;
  ]


---

# Batch normalization

1. Calculate the mean and variance of the layers input
  - mean: `\({\mu _{B}={\frac {1}{m}}\sum _{i=1}^{m}x_{i}}\)`
  - variance: `\({\sigma _{B}^{2}={\frac {1}{m}}\sum _{i=1}^{m}(x_{i}-\mu _{B})^{2}}\)`
2. Normalize the layer inputs using the previously calculated batch statistics `\({\large {\hat {x}}_{i}={\frac {x_{i}-\mu_{B}}{\sqrt {\sigma _{B}^{^{2}}+\epsilon }}}}\)`
3. Scale and shift in order to obtain the output of the layer `\(\large y_{i}=\gamma {\hat {x}}_{i}+\beta\)`



---

# Rectified Linear Unit (ReLU)


.center[
  `$$\Large f(x)=x^{+}=\max(0,x)$$`
  &lt;img src='images/relu.png' height='350'&gt;&lt;/img&gt;
]


---

# Max pooling

.center[
  &lt;img src='images/maxpooling.png' height='350'&gt;&lt;/img&gt;
]

`\(\Large max(1,1,5,6)=6\)`

---

# Model output

.center[
  &lt;img src='images/emphnet2.png' height='350'&gt;&lt;/img&gt;
  &lt;img src='images/dropout.gif' height='350'&gt;&lt;/img&gt;
]


---

# Model training

.center[
  &lt;img src='images/training.png' height='500'&gt;&lt;/img&gt;
 ]
 
---

# Loss function

Cross entropy
`$$\huge H(p,q)=-\sum_{x\in {\mathcal {X}}}p(x)\,\log q(x)$$`

---

# Physician-annotation versus emphysema probability

```
lmtest::lrtest(neg_t0, neg_emph_t0, neg_pemph_t0)
```

```
Model 1: case ~ log1yrisk - 1
Model 2: case ~ log1yrisk + log1yrisk:emphysema - 1
Model 3: case ~ log1yrisk + log1yrisk:p_emph - 1
Model 4: case ~ log1yrisk + log1yrisk:emphysema + log1yrisk:p_emph - 1

  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1   1 -370.74
2   2 -367.43  1 6.6249    0.01006 *
3   2 -367.23  0 0.3978    &lt; 2e-16 ***
4   3 -365.58  1 3.2994    0.06930 .
```

---

# New approach for positive scans

```
Model          AIC     AUROC    gain_capture   deviance   lrt_p_value
lcrat_ct       1635    0.777    0.555          1613.      NA
lcp            1520    0.850    0.700          1516.      NA
lcp_lcrat      1514    0.851    0.701          1508.      0.00431
lcp_lcrat_ct   1497    0.860    0.719          1473.      0.0000673
```

---

.center[
  &lt;a href="https://en.wikipedia.org/wiki/Lorenz_curve"&gt;
    &lt;img src="images/lorenz.png" height='550'&gt;&lt;/img&gt;
  &lt;/a&gt;
]

---

# Future Directions

.center[
  &lt;a href="https://doi.org/10.1093/jnci/djz041"&gt;
    &lt;img src='images/lung_features.jpg' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
]

---

# Global smoking deaths are on the rise [(IHME, 2018)](https://ourworldindata.org/grapher/smoking-and-secondhand-deaths)

.center[
  &lt;a href="https://ourworldindata.org/grapher/smoking-and-secondhand-deaths"&gt;
    &lt;img src='images/smoking-and-secondhand-deaths.png' height='500'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Future Directions

.center[
  &lt;a href="https://www.mdedge.com/chestphysician/article/158268/lung-cancer/states-show-large-disparities-lung-cancer-mortality"&gt;
    &lt;img src='images/lung_cancer_us.png' height='450'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

---

# Lung cancer mortality [(ACS, 2019)](https://www.cancer.org/research/cancer-facts-statistics/all-cancer-facts-figures/cancer-facts-figures-2019.html)

.pull.left[
  &lt;a href="https://www.cancer.org/research/cancer-facts-statistics/all-cancer-facts-figures/cancer-facts-figures-2019.html"&gt;
    &lt;img src='images/acs-cancer-mortality.png' height='225'&gt;&lt;/img&gt;
  &lt;/a&gt;
  ]

.center[
&lt;a href="https://www.cancer.org/research/cancer-facts-statistics/all-cancer-facts-figures/cancer-facts-figures-2019.html"&gt;
  &lt;img src='images/male-cancer-deaths.png' height='225'&gt;&lt;/img&gt;
&lt;/a&gt;
&lt;a href="https://www.cancer.org/research/cancer-facts-statistics/all-cancer-facts-figures/cancer-facts-figures-2019.html"&gt;
  &lt;img src='images/female-cancer-deaths.png' height='225'&gt;&lt;/img&gt;
&lt;/a&gt;
]

---

# Smoking: top modifiable risk factor [(Islami, 2018)]( https://doi.org/10.3322/caac.21440)

.center[
  &lt;figure&gt;
    &lt;a href=" https://doi.org/10.3322/caac.21440"&gt;
      &lt;img src='images/modifiable-risk-factors.png' height='425'&gt;&lt;/img&gt;
    &lt;/a&gt;
    &lt;figcaption&gt;Estimated Proportion and Number of Incident Cancer Cases Attributable to Evaluated Risk Factors in Adults Aged 30 Years and Older in the United States in 2014&lt;/figcaption&gt;
  &lt;/figure&gt;
  ]

---

# Acknowledgements

- DCEG Cancer Screening Group
  - Hormuzd Katki, PhD (preceptor)
  - Wes Caldwell
  - Hilary Robbins, PhD
  - Li Cheung, PhD
  - Christine Berg, MD
  - Anil Chaturvedi, PhD
  - Ronald M. Summers, MD, PhD

---

class: center, middle
# Thanks for listening!
---

class: center, middle
# Questions?
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
